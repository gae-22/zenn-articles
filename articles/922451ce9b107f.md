---
title: 'éƒ¨ä¼šã®æº–å‚™ãŒé¢å€’ã ã£ãŸè©±'
emoji: 'ğŸ™†'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Flask, Python, GAS]
published: true
---

# ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ï¼ã¾ãšã¯ã“ã®è¨˜äº‹ã‚’é–‹ã„ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ã“ã‚Œã¯ç§ãŒæ‰€å±ã™ã‚‹[MMA](https://wiki.mma.club.uec.ac.jp)ã¨ã„ã†ã‚µãƒ¼ã‚¯ãƒ«(ç·åˆæ ¼é—˜æŠ€ã˜ã‚ƒãªã„ã‚ˆ)ã®éƒ¨ä¼šã®æº–å‚™ã‚’æ¥½ã«ã—ã‚ˆã†ã¨ã—ãŸè©±ã§ã™ï¼

åˆå¿ƒè€…ãŒåˆå¿ƒè€…ãªã‚Šã«ä½œæˆã—ã¦è¨˜äº‹ã‚’æ›¸ãã®ã§ï¼Œæ‹™ã„éƒ¨åˆ†ã‚‚å¤šã„ã¨ã¯æ€ã„ã¾ã™ãŒï¼Œæœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ï¼

https://github.com/gae-22/club_meeting

# éƒ¨ä¼šã®æº–å‚™

MMA ã§ã¯ï¼Œæ¯é€±éƒ¨ä¼šã‚’è¡Œã£ã¦ã„ã¾ã™ï¼éƒ¨ä¼šã§ã¯ï¼Œæ¯é€±éƒ¨å“¡ã‹ã‚‰æŒ™ã’ã‚‰ã‚Œã‚‹è­°é¡Œã®è©±ã—åˆã„ã ã£ãŸã‚Šï¼Œè¬›ç¿’ä¼šã ã£ãŸã‚Šã‚’è¡Œã£ã¦ã„ã¾ã™ï¼å•é¡Œã¯ï¼Œè­°é¡Œã‚’æŠ•ç¥¨ã—ã¦æ±ºã‚ã‚‹ã¨ã“ã‚ã§ã™ï¼

ãã®æº–å‚™ã«ã¯ï¼Œæ¬¡ã®ã‚ˆã†ãªã‚‚ã®ãŒå¿…è¦ã§ã™ï¼

-   Wiki ã‹ã‚‰è­°é¡Œã®ç¢ºèª
-   æŠ•ç¥¨ç”¨ã® GoogleForm ã®ä½œæˆ
-   GoogleForm ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®š
-   GoogleForm ã®å…±æœ‰

ã‹ãªã‚Šã®ã‚ã‚“ã©ãã•ãŒã‚Šã®ç§ã«ã¯ï¼Œæ¯é€±ã“ã‚Œã‚‰ã®ä½œæ¥­ã‚’è¡Œã†ã®ã¯ã‹ãªã‚Šé¢å€’ãªä½œæ¥­ã§ã—ãŸï¼ã‚ã‚“ã©ãã•ã„ãªã‚‰è‡ªå‹•åŒ–ã—ã¦ã—ã¾ãŠã†ã¨æ€ã£ã¦ï¼Œéƒ¨ä¼šç”¨ã® Web ã‚¢ãƒ—ãƒª(?)ã‚’ä½œæˆã—ã¾ã—ãŸï¼(?)ãªã®ã¯ï¼Œå‹•çš„ã‚µã‚¤ãƒˆã§ã‚‚ãªã‚“ã§ã‚‚ãªãã¦ãŸã ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦ããŸã‚Šï¼ŒGoogleForm ã‚’ä½œæˆã—ãŸã‚Šã™ã‚‹ã ã‘ã ã‹ã‚‰ã§ã™ï¼ã¾ã‚è©³ç´°ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

# ä¸»ãªæ©Ÿèƒ½

-   Wiki ã‹ã‚‰è­°é¡Œã‚’å–å¾—
-   è­°é¡Œã‚’æŠ•ç¥¨ç”¨ã® GoogleForm ã«åæ˜ 
-   æŠ•ç¥¨ç”¨ã® GoogleForm ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
-   æŠ•ç¥¨ç”¨ã® GoogleForm ã‚’å…±æœ‰

ä»Šå›ä½œæˆã—ãŸ Web ã‚¢ãƒ—ãƒªã®ä¸»ãªæ©Ÿèƒ½ã¯ä¸Šè¨˜ã® 4 ã¤ã§ã™ï¼ã“ã‚Œã ã‘ã§ã‚‚ã‹ãªã‚Šæ¥½ã«ãªã‚Šã¾ã™ã­

# ä½œæˆè©³ç´°

ã“ã“ã‹ã‚‰ã¯ä½œæˆã«ã¤ã„ã¦ã®è©³ç´°ã‚’æ›¸ã„ã¦ã„ãã¾ã™ï¼ç´°ã‹ã„é–¢æ•°ã®ä½¿ã„æ–¹ã‚„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã©ã«ã¤ã„ã¦ã¯ãŸãã•ã‚“ãƒãƒƒãƒˆã«è»¢ãŒã£ã¦ã„ã‚‹ã®ã§çœç•¥ã—ã¾ã™ï¼

## å‹•ä½œç’°å¢ƒ

-   Python3
-   Flask

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

ã“ã®è¨˜äº‹å†…ã§ã¯ï¼Œéƒ¨ä¼šç”¨ã® Web ã‚¢ãƒ—ãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ï¼ã¾ãŸï¼Œã“ã®è¨˜äº‹å†…ã§æ›¸ã‹ã‚Œã‚‹ãƒ‘ã‚¹ã¯éƒ¨ä¼šç”¨ã® Web ã‚¢ãƒ—ãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã¨ã—ã¾ã™ï¼
:::details ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
.
â”œâ”€â”€ meeting/
â”‚   â”œâ”€â”€ models
â”‚   â”‚   â”œâ”€â”€ agenda.py
â”‚   â”‚   â”œâ”€â”€ password.py
â”‚   â”‚   â”œâ”€â”€ room.py
â”‚   â”‚   â”œâ”€â”€ scrape.py
â”‚   â”‚   â”œâ”€â”€ spread.py
â”‚   â”‚   â””â”€â”€ thread.py
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â””â”€â”€common.css
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”‚   â”œâ”€â”€logo.png
â”‚   â”‚   â”‚   â””â”€â”€qr.png
â”‚   â”‚   â””â”€â”€ javascript/
â”‚   â”‚       â””â”€â”€common.js
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ meeting/
â”‚   â”‚   â”‚   â”œâ”€â”€ agenda.html
â”‚   â”‚   â”‚   â”œâ”€â”€ form.html
â”‚   â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”‚   â”œâ”€â”€ room.html
â”‚   â”‚   â”‚   â””â”€â”€ thread.html
â”‚   â”‚   â””â”€â”€ layout.html
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ datas/
â”‚   â”œâ”€â”€ meeting.json  # ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®æƒ…å ±
â”‚   â”œâ”€â”€ password.txt  # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
â”‚   â””â”€â”€ config.ini    # Wikiã®ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±
â””â”€â”€ server.py
```

:::

## Wiki ã‹ã‚‰è­°é¡Œã‚’å–å¾—

ã¾ãšã¯ï¼ŒWiki ã‹ã‚‰è­°é¡Œã‚’å–å¾—ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰ã§ã™ï¼ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹ãŸã‚ã«ï¼Œ`BeautifulSoup`ã‚’åˆ©ç”¨ã—ã¾ã—ãŸï¼Wiki ã‹ã‚‰è­°é¡Œã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã¯ï¼ŒWiki ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ãã®ãŸã‚ã«ã¯ï¼Œãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒå¿…è¦ã§ã™ï¼ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã¯`./datas/config.ini`ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ï¼

:::details config.ini

```Python: ./data/config.ini
[User]
name     : <id>
password : <password>
```

:::

ã“ã®`<id>`ã¨`<password>`ã«ã¯ï¼Œè‡ªåˆ†ã®ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’æ›¸ãã¾ã™ï¼
ãã—ã¦ï¼Œå®Ÿéš›ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚’è¡Œã†ã®ã¯`./meeting/models/scrape.py`ã§ã™ï¼

:::details scrape.py

```Python: ./meeting/models/scrape.py
import requests, configparser
import BeautifulSoup

def scrape(URL):
    config_file = "./datas/config.ini"
    config = configparser.ConfigParser()
    config.read(config_file, encoding="utf-8")
    name = config.get("User", "name")
    password = config.get("User", "password")

    login_info = {
        "name": name,
        "password": password,
        "login": "ãƒ­ã‚°ã‚¤ãƒ³",
        "login": "ãƒ­ã‚°ã‚¤ãƒ³",
    }

    session = requests.session()
    res = session.post(URL, data=login_info)
    soup = BeautifulSoup(res.content, "html.parser")

    return soup
```

:::

ãŸã ã—ï¼Œ`./meeting/models/scrape.py`ã§è¡Œã†ã®ã¯ html ã®å–å¾—ã®ã¿ã§ã™ï¼html ã‹ã‚‰è­°é¡Œã‚’å–å¾—ã™ã‚‹ã®ã¯`./meeting/models/thread.py`ã§ã™ï¼

:::details thread.py

```Python: ./meeting/models/thread.py
from meeting.models.scrape import scrape
from datetime import datetime
import re


def update():
    BBS_URL = (<ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å…ˆã®URL>)
    soup = scrape(BBS_URL)
    tbody = soup.find("tbody")
    mat = []
    trs = tbody.find_all("tr")
    for tr in trs:
        r = []
        for td in tr.find_all("td"):
            instead = [
                "<td>",
                "</td>",
                "<strong>",
                "</strong>",
                '<td colspan="3" style="text-align: center;">',
                '<td colspan="3" style="text-align: left;">',
                "</a>",
            ]
            td = str(td).replace("<br/>", "\n")
            td = re.sub(r"<a href=(.*?)\">", "", td)
            for item in instead:
                td = str(td).replace(item, "")
            r.append(td)
        mat.append(r)

    return mat[0:-1]

```

:::

ä»Šå›ã®å–å¾—ã—ãŸã„æƒ…å ±ã¯è¡¨ã¨ãªã£ã¦ã„ã‚‹ãŸã‚ï¼Œ`<tbody>`ã‚¿ã‚°ã®ä¸­èº«ã‚’å–å¾—ã—ã¦ã„ã¾ã™ï¼ã¾ãŸï¼Œ`<td>`ã‚¿ã‚°ã®ä¸­èº«ã‚’å–å¾—ã™ã‚‹éš›ã«ï¼Œ`<br/>`ã‚¿ã‚°ã‚’æ”¹è¡Œã«å¤‰æ›ã—ã¦ã„ã¾ã™ï¼ã¾ãŸï¼Œãã®ä»–ã®ã‚¿ã‚°ã¯å‰Šé™¤ã—ã¦ã„ã¾ã™ï¼ã“ã“ã¯ï¼Œè‡ªåˆ†ã®å–å¾—ã—ãŸã„æƒ…å ±ã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ï¼

ã¾ãŸï¼Œã“ã‚Œã¯ URL å…ˆã®å…¨ã¦ã®æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™ãŒï¼Œç›´è¿‘ã®è­°é¡Œã®ã¿ã‚’éƒ¨ä¼šã§ã¯ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼Œç›´è¿‘ã®ã¿ã‚’å–å¾—ã™ã‚‹`./meeting/models/agenda.py`ã‚‚ä½œæˆã—ã¾ã—ãŸï¼

:::details agenda.py

```Python: ./meeting/models/agenda.py
from meeting.models.thread import update
import re


def get_agendas():
    BBS_ARRAY = update()
    length = len(BBS_ARRAY)
    agendas = []
    for i in range(0, length):
        element = BBS_ARRAY[length - i - 1][0]
        if re.match("\s*--", element):
            agendas = BBS_ARRAY[length - i - 2 : length]
            break

    return agendas

```

:::

è­°é¡Œã‚’æŒ™ã’ã‚‹éš›ã®æ›¸å¼ã¨ã—ã¦ï¼Œ`--`ã§å§‹ã¾ã‚‹è¡Œã®æ¬¡ã®è¡Œã‹ã‚‰ãŒè­°é¡Œã¨ãªã£ã¦ã„ã¾ã™ï¼ãã®ãŸã‚ï¼Œ`--`ã§å§‹ã¾ã‚‹è¡Œã®æ¬¡ã®è¡Œã‹ã‚‰ã‚’å–å¾—ã—ã¦ã„ã¾ã™ï¼

## è­°é¡Œã‚’æŠ•ç¥¨ç”¨ã® GoogleForm ã«åæ˜ 

æ¬¡ã«ï¼Œè­°é¡Œã‚’æŠ•ç¥¨ç”¨ã® GoogleForm ã«åæ˜ ã™ã‚‹ã¨ã“ã‚ã§ã™ï¼GoogleForm ã«åæ˜ ã™ã‚‹ãŸã‚ã«ï¼ŒPython ã‹ã‚‰ GoogleSpreadSheet ã«ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ï¼Œãã‚Œã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦ GAS ã‚’ç”¨ã„ã¦ GoogleForm ã‚’ä½œæˆã—ã¦ã„ã¾ã™ï¼

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®š

ã¾ãšã¯ï¼Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®šã§ã™ï¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯`./datas/password.txt`ã«ä¸€è¦§ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã™ï¼éƒ¨ä¼šã® Web ã‚¢ãƒ—ãƒªã§ã¯ï¼Œã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦ã„ã¾ã™ï¼ã“ã‚Œã¯ãã‚‚ãã‚‚ GoogleForm ã‚’è§£ç­”ã§ãã‚‹äººã«åˆ¶é™ãŒã‹ã‹ã£ã¦ãŠã‚Šï¼Œã“ã‚Œã‚’è¦‹ã‚‰ã‚Œã‚‹äººã‚‚å°‘ãªã„ãŸã‚ï¼Œãƒ©ãƒ³ãƒ€ãƒ ã§ã¯ãªã MMA ã«é–¢ä¿‚ã™ã‚‹å˜èªã®ä¸€è¦§ã«ã—ã¦ã„ã¾ã™ï¼(ãã‚Œã§ã‚‚æœ¬å½“ã¯ãƒ©ãƒ³ãƒ€ãƒ ã«ã—ãŸã»ã†ãŒè‰¯ã„ã§ã™ãŒ)

:::details password.py

```Python: ./meeting/models/password.py
import datetime, random, string
from meeting.models.spread import write_password

password_past = ""


def reload_time():
    mtg_from_time = datetime.time(16, 40, 00)
    mtg_to_time = datetime.time(17, 20, 00)
    mtg_wkdy = 0

    now_time = datetime.datetime.now().time()
    now_wkdy = datetime.datetime.now().weekday()

    return (
        True
        if mtg_from_time < now_time < mtg_to_time and now_wkdy == mtg_wkdy
        else False
    )


def choose_random():
    global password_past
    pass_path = "./datas/password.txt"

    with open(pass_path, "r") as f:
        lines = f.read().splitlines()

    while True:
        password = random.choice(lines)
        if password != password_past:
            break
    write_password(password)
    return password


def randomname(n):
    global password_past
    password = ""

    if reload_time():
        password = password_past
    elif password == "":
        password = choose_random()

    if password == 1:
        randlst = [
            random.choice(string.ascii_lowercase + string.digits) for i in range(n)
        ]
        password_past = password = "".join(randlst)
        write_password(password)

    return password
```

:::

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®šã¯æ¯é€±æœˆæ›œæ—¥ã® 16:40~17:20 ã«è¡Œã‚ã‚Œã¾ã™ï¼ã“ã‚Œã¯ï¼Œéƒ¨ä¼šã®æ™‚é–“ã«åˆã‚ã›ã¦ã„ã¾ã™ï¼ã¾ãŸï¼Œã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«æ›¸ãè¾¼ã‚€ã®ã¯ï¼Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã®ã¿ã§ã™ï¼ãã‚Œã‚’è¡Œã†ã®ã¯`./meeting/models/spread.py`ã®`write_password`é–¢æ•°ã§ã™ï¼

:::details spread.py

```Python: ./meeting/models/spread.py
import gspread
from meeting.models.agenda import get_agendas

key_name = "./datas/meeting.json"
sheet_name = "éƒ¨ä¼š"
sheet_id = "<ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ID>"


def write_password(password):
    sheet_name = "<ã‚·ãƒ¼ãƒˆå>"
    gc = gspread.service_account(filename=key_name)
    wks = gc.open_by_key(sheet_id).worksheet(sheet_name)
    wks.update_cell(8, 2, password)


def write_agenda():
    sheet_name = "<ã‚·ãƒ¼ãƒˆå>"
    gc = gspread.service_account(filename=key_name)
    wks = gc.open_by_key(sheet_id).worksheet(sheet_name)
    agendas = get_agendas()
    k = 3
    cnt = 0
    for agenda in agendas:
        cnt += 1
        if cnt % 2 == 0:
            agenda = agenda[0]
            idx = agenda.find("+")
            agenda = agenda[idx + 1 :]
            idx = agenda.find("\n")
            agenda = agenda[:idx]
            if "å‘ŠçŸ¥" not in agenda:
                wks.update_cell(k, 1, agenda)
                k += 1

```

:::
ã“ã®`write_agenda`é–¢æ•°ã§ GoogleForm ã«ä½œæˆã«ç”¨ã„ã‚‹è­°é¡Œã®æ›¸ãè¾¼ã¿ã‚‚è¡Œã£ã¦ã„ã¾ã™ï¼

### GoogleForm ã®ä½œæˆ

æ¬¡ã«ï¼ŒGoogleForm ã®ä½œæˆã§ã™ï¼GoogleForm ã®ä½œæˆã¯ GAS ã§è¡Œã£ã¦ã„ã¾ã™ï¼

:::details Google Apps Script

```JavaScript: ./meeting/models/form.gs
// å„ã‚¢ã‚¤ãƒ†ãƒ ä½œæˆ
function createItem(form, title, type, help, required) {
    if (type == 'ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³') {
        return form
            .addMultipleChoiceItem()
            .setTitle(title)
            .setHelpText(help)
            .setRequired(required);
    } else if (type == 'ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹') {
        return form
            .addCheckboxItem()
            .setTitle(title)
            .setHelpText(help)
            .setRequired(required);
    } else if (type == 'ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³') {
        return form
            .addListItem()
            .setTitle(title)
            .setHelpText(help)
            .setRequired(required);
    } else if (type == 'è¨˜è¿°å¼') {
        return form
            .addTextItem()
            .setTitle(title)
            .setHelpText(help)
            .setRequired(required);
    } else if (type == 'æ—¥ä»˜') {
        return form
            .addDateItem()
            .setTitle(title)
            .setHelpText(help)
            .setRequired(required);
    }
}

// ãƒ•ã‚©ãƒ¼ãƒ å†…å®¹&å›ç­”å‰Šé™¤
function clearForm(form) {
    // ãƒ•ã‚©ãƒ¼ãƒ å†…ã®è³ªå•ã‚’ã™ã¹ã¦å‰Šé™¤
    var items = form.getItems();
    while (items.length > 0) {
        form.deleteItem(items[0]);
        items = form.getItems(); // ãƒ«ãƒ¼ãƒ—ã®ãŸã³ã« items ã‚’å†å–å¾—ã—ã¦æ®‹ã‚Šã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç¢ºèª
    }
    // ãƒ•ã‚©ãƒ¼ãƒ ã®å›ç­”ã‚’å‰Šé™¤
    form.deleteAllResponses();

    var ss = SpreadsheetApp.getActiveSpreadsheet();
    //ã‚·ãƒ¼ãƒˆåã¯ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
    var sh = ss.getSheetByName('å›ç­”');
    //ã‚·ãƒ¼ãƒˆã®ã™ã¹ã¦ã‚’ã‚¯ãƒªã‚¢ã™ã‚‹
    sh.clear();
}

// ãƒ¡ã‚¤ãƒ³é–¢æ•°
function main(password) {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    // // æ¦‚è¦ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ•ã‚©ãƒ¼ãƒ ã®IDã‚’å–å¾—ã™ã‚‹
    const formId = ss.getSheetByName('æ¦‚è¦').getRange('B6').getValue();
    var form = FormApp.openById(formId);

    // ãƒ•ã‚©ãƒ¼ãƒ å†…ã®è³ªå•ã¨å›ç­”ã‚’ã‚¯ãƒªã‚¢
    clearForm(form);

    // ã“ã“ã«ãƒ•ã‚©ãƒ¼ãƒ ã®ç·¨é›†ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
    const formTitle = ss.getSheetByName('æ¦‚è¦').getRange('B1').getValue();
    const formDescription = ss.getSheetByName('æ¦‚è¦').getRange('B2').getValue();

    form.setTitle(formTitle);
    form.setDescription(formDescription);

    // è³ªå•ã‚·ãƒ¼ãƒˆã®å€¤ã‚’å–å¾—
    const q_sheet = ss.getSheetByName('è³ªå•');
    const rows = q_sheet.getLastRow();
    const columns = q_sheet.getLastColumn();
    const q_values = q_sheet.getRange(1, 1, rows, columns).getValues();

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä½œæˆ
    const p_sheet = ss.getSheetByName('æ¦‚è¦');
    var title = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰';
    var help = 'ä»Šå›ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
    var password = p_sheet.getRange('B8').getValue();
    var pass = FormApp.createTextValidation();
    var valid = pass
        .requireTextMatchesPattern(password)
        .setHelpText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™')
        .build();
    createItem(form, title, 'è¨˜è¿°å¼', help, true).setValidation(valid);

    form.addPageBreakItem()
        .setTitle('è­°é¡Œ')
        .setHelpText('ä»¥ä¸‹ã®è­°é¡Œã«å›ç­”ã—ã¦ãã ã•ã„ï¼');

    // ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã™ã‚‹
    for (let i = 1; i < rows - 1; i++) {
        const title = q_values[i + 1][0];
        const type = q_values[i + 1][1];
        const help = q_values[i + 1][2];
        var required = q_values[i + 1][3];
        if (required != true) required = false;

        let choiceVals = [];
        for (let j = 2; j < columns - 2; j++) {
            const choiceVal = q_values[i + 1][j + 2];
            if (choiceVal == '') {
                break;
            } else {
                choiceVals.push(choiceVal);
            }
        }

        const item = createItem(form, title, type, help, required);

        if (
            choiceVals.length != 0 &&
            (type == 'ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³' ||
                type == 'ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹' ||
                type == 'ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³')
        ) {
            item.setChoiceValues(choiceVals);
        }
    }
    // åˆå›ãƒ•ã‚©ãƒ¼ãƒ URLå–å¾—ç”¨
    ss.getSheetByName('æ¦‚è¦').getRange('B4').setValue(form.getEditUrl());
    ss.getSheetByName('æ¦‚è¦').getRange('B5').setValue(form.getPublishedUrl());
}

```

:::

ã“ã® GAS ã‚’ä½¿ã†ã“ã¨ã§ï¼Œå„é …ç›®ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚„ã‚¿ã‚¤ãƒ—ï¼Œé¸æŠè‚¢ãªã©ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ã¾ãŸï¼Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§èª¬æ˜ã‚„å¿…é ˆé …ç›®ã®è¨­å®šã‚‚ã§ãã¾ã™ï¼æ‰‹å‹•ã§ä½œæˆã™ã‚‹ã®ã¯ã‹ãªã‚Šé¢å€’ãªã®ã§ï¼Œã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§ã‹ãªã‚Šæ¥½ã«ãªã‚Šã¾ã™ï¼

ã“ã“ã¾ã§ã§ï¼ŒGoogleForm ã®ä½œæˆã¯å®Œäº†ã§ã™ï¼ã‚‚ã†ä¸€åº¦ï¼ŒPython ã‹ã‚‰ GoogleForm ã‚’ä½œæˆã™ã‚‹æµã‚Œã‚’ç¢ºèªã—ã¦ãŠãã¨ï¼ŒPython ã‹ã‚‰ GoogleSpreadSheet ã«ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨è­°é¡Œã‚’å…¥åŠ›ã—ï¼Œãã‚Œã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦ GAS ã‚’ç”¨ã„ã¦ GoogleForm ã‚’ä½œæˆã—ã¦ã„ã¾ã™ï¼ãšã„ã¶ã‚“é•·ã„é“ã®ã‚Šã§ã—ãŸã­ï¼

# Flask ã§ Web ã‚¢ãƒ—ãƒªã‚’ä½œæˆ

ã“ã“ã¾ã§ã§ï¼Œè­°é¡Œã‚’å–å¾—ã—ã¦ GoogleForm ã‚’ä½œæˆã™ã‚‹ã¨ã“ã‚ã¾ã§ã§ãã¾ã—ãŸï¼æ¬¡ã«ï¼ŒFlask ã‚’ç”¨ã„ã¦ Web ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ï¼Flask ã®ä½¿ã„æ–¹ã¯ãã“ã¾ã§é›£ã—ã„ã“ã¨ã¯ã—ã¦ã„ãªã„ã®ã§ï¼Œè©³ç´°ã¯çœç•¥ã—ã¾ã™ï¼å…¬å¼ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã‚„ã‚Œã°å¤§æŠµã®ã“ã¨ã¯ç†è§£ã§ãã‚‹ã¨æ€ã„ã¾ã™ï¼ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯ã‹ãªã‚Šåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ï¼

ã“ã® Web ã‚¢ãƒ—ãƒªä¸Šã§ï¼Œå…ˆã»ã©å–å¾—ã—ãŸè­°é¡Œã‚„ GoogleForm ã® QR ã‚³ãƒ¼ãƒ‰ ã‚’è¡¨ç¤ºã•ã›ã¾ã™ï¼ã¾ãŸï¼Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¡¨ç¤ºã‚‚ã“ã® Web ã‚¢ãƒ—ãƒªä¸Šã§è¡Œã„ã¾ã™ï¼ç¾çŠ¶ã§ã¯æ¯å›`localhost`ã‚’ç«‹ã¦ã¦ã„ã‚‹ã®ã§å¤–éƒ¨ã‹ã‚‰è¦‹ã‚‰ã‚Œã‚‹å¿ƒé…ã¯ã‚ã¾ã‚Šã‚ã‚Šã¾ã›ã‚“ï¼(ã¡ã‚ƒã‚“ã¨ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’ã¤ã‘ã¦å…¬é–‹ã—ãŸã„)

# ã¾ã¨ã‚

ã“ã“ã¾ã§ã§ï¼Œéƒ¨ä¼šã®æº–å‚™ã‚’æ¥½ã«ã™ã‚‹ãŸã‚ã® Web ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ãŸï¼ã“ã‚Œã§ï¼Œéƒ¨ä¼šã®æº–å‚™ãŒã‹ãªã‚Šæ¥½ã«ãªã‚Šã¾ã—ãŸï¼éƒ¨é•·ã®ã‚ã‚“ã©ãã•ãŒã‚ŠãŒã‚‚ã£ã¨åŠ é€Ÿã—ãã†ã§ã™ã­ï¼ã“ã“ã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼

# å‚è€ƒæ–‡çŒ®

-   [ã€Pythonã€‘ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°](https://zenn.dev/tomofyro/articles/55bc5dc90685ad)
-   [ãƒ­ã‚°ã‚¤ãƒ³ã®ã‚ã‚‹ Web ã‚µã‚¤ãƒˆã‹ã‚‰ã®ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°](https://zenn.dev/mamekko/articles/ea44fe8a77da7c)
-   [gspread ã§ Python ã‹ã‚‰ Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’æ‰±ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã¾ã§](https://zenn.dev/yamagishihrd/articles/2022-09_01-google-spreadsheet-with-python)
-   [Google Apps Script (GAS) Ã— Google ãƒ•ã‚©ãƒ¼ãƒ  ã‚’ä½¿ã£ã¦ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’è‡ªå‹•ä½œæˆã™ã‚‹](https://www.aligns.co.jp/blog/googleworkspace/)
-   [Flusk Documentation æ—¥æœ¬èªè¨³](https://msiz07-flask-docs-ja.readthedocs.io/ja/latest/)
